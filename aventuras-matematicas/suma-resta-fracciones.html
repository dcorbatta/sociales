<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ûï‚ûñ Suma y Resta de Fracciones</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 20px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .score-board {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .score {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .main-content {
            flex: 1;
            padding: 30px 20px;
        }

        .lesson-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .lesson-title {
            font-size: 2rem;
            color: #4facfe;
            text-align: center;
            margin-bottom: 20px;
        }

        .explanation {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: center;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .rule-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 3px solid #4facfe;
            transition: all 0.3s ease;
        }

        .rule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(79, 172, 254, 0.3);
        }

        .rule-title {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .rule-example {
            font-size: 2rem;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            margin: 15px 0;
            font-weight: bold;
        }

        .rule-explanation {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.4;
        }

        .visual-demo {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .fraction-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .circles-container {
            display: flex;
            gap: 5px;
        }

        .circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #2c3e50;
            position: relative;
            overflow: hidden;
        }

        .circle-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .interactive-section {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
        }

        .interactive-title {
            font-size: 1.8rem;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }

        .calculator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .operation-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .op-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .op-btn:hover, .op-btn.active {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.4);
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .fraction-inputs {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .fraction-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .fraction-input input {
            width: 60px;
            height: 50px;
            font-size: 1.5rem;
            text-align: center;
            border: 3px solid #4facfe;
            border-radius: 8px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .fraction-line {
            width: 60px;
            height: 3px;
            background: #2c3e50;
        }

        .operation-symbol {
            font-size: 3rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .equals-symbol {
            font-size: 3rem;
            font-weight: bold;
            color: #27ae60;
        }

        .calculate-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.4);
        }

        .result-display {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .result-fraction {
            font-size: 3rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #27ae60;
            margin: 10px 0;
        }

        /* Proper fraction display styles */
        .fraction-proper {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 10px;
        }

        .fraction-proper .numerator {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            line-height: 1;
            margin-bottom: 2px;
        }

        .fraction-proper .fraction-line {
            width: 100%;
            min-width: 40px;
            height: 3px;
            background: #2c3e50;
            margin: 2px 0;
        }

        .fraction-proper .denominator {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            line-height: 1;
            margin-top: 2px;
        }

        /* Large fraction display for results */
        .fraction-large {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 15px;
        }

        .fraction-large .numerator {
            font-size: 2.5rem;
            font-weight: bold;
            color: #27ae60;
            line-height: 1;
            margin-bottom: 5px;
        }

        .fraction-large .fraction-line {
            width: 100%;
            min-width: 60px;
            height: 4px;
            background: #27ae60;
            margin: 3px 0;
        }

        .fraction-large .denominator {
            font-size: 2.5rem;
            font-weight: bold;
            color: #27ae60;
            line-height: 1;
            margin-top: 5px;
        }

        .step-by-step {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: left;
        }

        .step {
            margin: 10px 0;
            font-size: 1.1rem;
            color: #555;
        }

        .step-number {
            background: #4facfe;
            color: white;
            padding: 5px 10px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }

        .practice-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
        }

        .exercise-card {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 3px solid #4caf50;
        }

        .exercise-problem {
            font-size: 2.5rem;
            font-family: 'Courier New', monospace;
            text-align: center;
            color: #2c3e50;
            margin: 20px 0;
            font-weight: bold;
        }

        .answer-input {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .answer-input input {
            width: 80px;
            height: 60px;
            font-size: 2rem;
            text-align: center;
            border: 3px solid #4facfe;
            border-radius: 10px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .check-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .check-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(39, 174, 96, 0.4);
        }

        .feedback {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            display: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            gap: 20px;
        }

        .nav-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(79, 172, 254, 0.4);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .animated-icon {
            animation: bounce 2s infinite;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .rules-grid { grid-template-columns: 1fr; }
            .fraction-inputs { flex-direction: column; }
            .navigation { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚ûï‚ûñ Suma y Resta de Fracciones</h1>
            <div class="score-board">
                <span class="score">üåü Puntos: <span id="totalPoints">0</span></span>
                <span class="score">üéØ Ejercicios: <span id="completedExercises">0</span> de 8</span>
            </div>
        </header>

        <main class="main-content">
            <!-- Lecci√≥n Te√≥rica -->
            <section class="lesson-section">
                <h2 class="lesson-title">Reglas para Sumar y Restar Fracciones <span class="animated-icon">‚ûï</span></h2>
                <p class="explanation">
                    Para sumar y restar fracciones necesitamos seguir reglas especiales. 
                    ¬°Es como juntar o separar pedazos de pizza, pero primero deben ser del mismo tama√±o! üçï‚ú®
                </p>

                <div class="rules-grid">
                    <div class="rule-card">
                        <div class="rule-title">üü∞ Mismo Denominador</div>
                        <div class="rule-example">2/5 + 1/5 = 3/5</div>
                        <div class="visual-demo">
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 40% 0, 40% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>2/5</span>
                            </div>
                            <span style="font-size: 2rem; color: #e74c3c;">+</span>
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 20% 0, 20% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>1/5</span>
                            </div>
                            <span style="font-size: 2rem; color: #27ae60;">=</span>
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 60% 0, 60% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>3/5</span>
                            </div>
                        </div>
                        <div class="rule-explanation">
                            Si tienen el mismo denominador, sumamos o restamos solo los numeradores
                        </div>
                    </div>
                    
                    <div class="rule-card">
                        <div class="rule-title">üîÑ Diferente Denominador</div>
                        <div class="rule-example">1/2 + 1/4 = 3/4</div>
                        <div class="visual-demo">
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>1/2 = 2/4</span>
                            </div>
                            <span style="font-size: 2rem; color: #e74c3c;">+</span>
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 25% 0, 25% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>1/4</span>
                            </div>
                            <span style="font-size: 2rem; color: #27ae60;">=</span>
                            <div class="fraction-visual">
                                <div class="circles-container">
                                    <div class="circle">
                                        <div class="circle-fill" style="clip-path: polygon(0 0, 75% 0, 75% 100%, 0 100%);"></div>
                                    </div>
                                </div>
                                <span>3/4</span>
                            </div>
                        </div>
                        <div class="rule-explanation">
                            Si tienen diferente denominador, primero buscamos fracciones equivalentes con el mismo denominador
                        </div>
                    </div>
                </div>
            </section>

            <!-- Calculadora Interactiva -->
            <section class="interactive-section">
                <h2 class="interactive-title">üßÆ Calculadora de Fracciones</h2>
                <div class="calculator">
                    <div class="operation-selector">
                        <button class="op-btn active" id="sumBtn" onclick="setOperation('+')">‚ûï Suma</button>
                        <button class="op-btn" id="subBtn" onclick="setOperation('-')">‚ûñ Resta</button>
                    </div>
                    
                    <div class="fraction-inputs">
                        <div class="fraction-input">
                            <input type="number" id="num1" min="1" max="20" placeholder="1">
                            <div class="fraction-line"></div>
                            <input type="number" id="den1" min="1" max="20" placeholder="2">
                        </div>
                        
                        <div class="operation-symbol" id="operationSymbol">+</div>
                        
                        <div class="fraction-input">
                            <input type="number" id="num2" min="1" max="20" placeholder="1">
                            <div class="fraction-line"></div>
                            <input type="number" id="den2" min="1" max="20" placeholder="4">
                        </div>
                        
                        <div class="equals-symbol">=</div>
                        
                        <button class="calculate-btn" onclick="calculateFractions()">üîç Calcular</button>
                    </div>
                    
                    <div class="result-display" id="resultDisplay">
                        <p>Ingresa dos fracciones para calcular</p>
                    </div>
                    
                    <div class="step-by-step" id="stepsDisplay" style="display: none;">
                        <h3 style="color: #4facfe; margin-bottom: 15px;">üìù Pasos de la Soluci√≥n:</h3>
                        <div id="stepsContent"></div>
                    </div>
                </div>
            </section>

            <!-- Ejercicios de Pr√°ctica -->
            <section class="practice-section">
                <h2 class="lesson-title">üéØ Ejercicios de Pr√°ctica</h2>
                
                <div class="exercise-card" id="exerciseCard">
                    <div class="exercise-problem" id="exerciseProblem">
                        1/3 + 1/6 = ?
                    </div>
                    
                    <div class="answer-input">
                        <input type="number" id="answerNum" min="1" max="50" placeholder="?">
                        <div class="fraction-line"></div>
                        <input type="number" id="answerDen" min="1" max="50" placeholder="?">
                        <button class="check-btn" onclick="checkAnswer()">‚úÖ Verificar</button>
                    </div>
                    
                    <div class="feedback" id="feedback">
                        <!-- Mensaje de retroalimentaci√≥n -->
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="calculate-btn" onclick="nextExercise()">‚û°Ô∏è Siguiente Ejercicio</button>
                    <button class="calculate-btn" onclick="showHint()" style="background: linear-gradient(45deg, #ff9a9e, #fecfef);">üí° Pista</button>
                </div>
            </section>

            <div class="navigation">
                <a href="comparar-fracciones.html" class="nav-btn">‚¨ÖÔ∏è Anterior: Comparar Fracciones</a>
                <a href="problemas-fracciones.html" class="nav-btn">Siguiente: Problemas con Fracciones ‚û°Ô∏è</a>
            </div>
        </main>
    </div>

    <script>
        // Variables globales
        let totalPoints = parseInt(localStorage.getItem('mathPoints') || '0');
        let completedExercises = 0;
        let currentOperation = '+';
        let currentExerciseIndex = 0;

        // Ejercicios de pr√°ctica
        const exercises = [
            { problem: '1/3 + 1/6', num1: 1, den1: 3, num2: 1, den2: 6, operation: '+', answerNum: 1, answerDen: 2 },
            { problem: '2/5 + 1/5', num1: 2, den1: 5, num2: 1, den2: 5, operation: '+', answerNum: 3, answerDen: 5 },
            { problem: '3/4 - 1/4', num1: 3, den1: 4, num2: 1, den2: 4, operation: '-', answerNum: 1, answerDen: 2 },
            { problem: '1/2 + 1/8', num1: 1, den1: 2, num2: 1, den2: 8, operation: '+', answerNum: 5, answerDen: 8 },
            { problem: '5/6 - 1/3', num1: 5, den1: 6, num2: 1, den2: 3, operation: '-', answerNum: 1, answerDen: 2 },
            { problem: '2/3 + 1/4', num1: 2, den1: 3, num2: 1, den2: 4, operation: '+', answerNum: 11, answerDen: 12 },
            { problem: '7/8 - 3/8', num1: 7, den1: 8, num2: 3, den2: 8, operation: '-', answerNum: 1, answerDen: 2 },
            { problem: '3/5 + 1/10', num1: 3, den1: 5, num2: 1, den2: 10, operation: '+', answerNum: 7, answerDen: 10 }
        ];

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            loadExercise();
        });

        function updateDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('completedExercises').textContent = completedExercises;
        }

        // Funciones de la calculadora
        function setOperation(op) {
            currentOperation = op;
            document.getElementById('operationSymbol').textContent = op;
            
            // Actualizar botones
            document.getElementById('sumBtn').classList.toggle('active', op === '+');
            document.getElementById('subBtn').classList.toggle('active', op === '-');
        }

        function calculateFractions() {
            const num1 = parseInt(document.getElementById('num1').value);
            const den1 = parseInt(document.getElementById('den1').value);
            const num2 = parseInt(document.getElementById('num2').value);
            const den2 = parseInt(document.getElementById('den2').value);

            if (!num1 || !den1 || !num2 || !den2) {
                document.getElementById('resultDisplay').innerHTML = '<p style="color: #e74c3c;">‚ö†Ô∏è Por favor, completa todas las fracciones</p>';
                return;
            }

            const result = performOperation(num1, den1, num2, den2, currentOperation);
            displayResult(result, num1, den1, num2, den2, currentOperation);
            addPoints(15);
            showFloatingPoints(15);
        }

        function performOperation(num1, den1, num2, den2, operation) {
            let resultNum, resultDen;
            
            if (den1 === den2) {
                // Mismo denominador
                if (operation === '+') {
                    resultNum = num1 + num2;
                } else {
                    resultNum = num1 - num2;
                }
                resultDen = den1;
            } else {
                // Diferente denominador - usar denominador com√∫n
                const commonDen = den1 * den2;
                const newNum1 = num1 * den2;
                const newNum2 = num2 * den1;
                
                if (operation === '+') {
                    resultNum = newNum1 + newNum2;
                } else {
                    resultNum = newNum1 - newNum2;
                }
                resultDen = commonDen;
            }
            
            // Simplificar resultado
            const gcd = findGCD(Math.abs(resultNum), resultDen);
            return {
                num: resultNum / gcd,
                den: resultDen / gcd,
                originalNum: resultNum,
                originalDen: resultDen
            };
        }

        function findGCD(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // Function to create proper fraction display
        function createFractionHTML(numerator, denominator, cssClass = 'fraction-proper') {
            if (denominator === 1) {
                return `<span style="font-size: 2rem; font-weight: bold; color: #27ae60;">${numerator}</span>`;
            }
            return `
                <div class="${cssClass}">
                    <div class="numerator">${numerator}</div>
                    <div class="fraction-line"></div>
                    <div class="denominator">${denominator}</div>
                </div>
            `;
        }

        function displayResult(result, num1, den1, num2, den2, operation) {
            const resultDisplay = document.getElementById('resultDisplay');
            const stepsDisplay = document.getElementById('stepsDisplay');
            const stepsContent = document.getElementById('stepsContent');

            let resultHTML;
            if (result.num === 0) {
                resultHTML = '<span style="font-size: 3rem; font-weight: bold; color: #27ae60;">0</span>';
            } else {
                resultHTML = createFractionHTML(result.num, result.den, 'fraction-large');
            }

            const operationSymbol = operation === '+' ? '+' : '‚àí';
            
            resultDisplay.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin: 20px 0;">
                    ${createFractionHTML(num1, den1)}
                    <span style="font-size: 2.5rem; color: #e74c3c;">${operationSymbol}</span>
                    ${createFractionHTML(num2, den2)}
                    <span style="font-size: 2.5rem; color: #27ae60;">=</span>
                    ${resultHTML}
                </div>
                <p style="color: #555; margin-top: 15px;">¬°Resultado calculado!</p>
            `;

            // Mostrar pasos
            let steps = '';
            if (den1 === den2) {
                steps = `
                    <div class="step"><span class="step-number">1</span>Como tienen el mismo denominador (${den1}), ${operation === '+' ? 'sumamos' : 'restamos'} los numeradores:</div>
                    <div class="step"><span class="step-number">2</span>${num1} ${operation} ${num2} = ${operation === '+' ? num1 + num2 : num1 - num2}</div>
                    <div class="step"><span class="step-number">3</span>Resultado: ${createFractionHTML(result.originalNum, result.originalDen)}</div>
                `;
            } else {
                const commonDen = den1 * den2;
                const newNum1 = num1 * den2;
                const newNum2 = num2 * den1;
                
                steps = `
                    <div class="step"><span class="step-number">1</span>Buscamos denominador com√∫n: ${den1} √ó ${den2} = ${commonDen}</div>
                    <div class="step"><span class="step-number">2</span>Convertimos fracciones: ${createFractionHTML(num1, den1)} = ${createFractionHTML(newNum1, commonDen)} y ${createFractionHTML(num2, den2)} = ${createFractionHTML(newNum2, commonDen)}</div>
                    <div class="step"><span class="step-number">3</span>${operation === '+' ? 'Sumamos' : 'Restamos'} numeradores: ${newNum1} ${operation} ${newNum2} = ${result.originalNum}</div>
                    <div class="step"><span class="step-number">4</span>Resultado: ${createFractionHTML(result.originalNum, result.originalDen)}</div>
                `;
            }

            if (result.originalNum !== result.num || result.originalDen !== result.den) {
                steps += `<div class="step"><span class="step-number">5</span>Simplificamos: ${createFractionHTML(result.num, result.den)}</div>`;
            }

            stepsContent.innerHTML = steps;
            stepsDisplay.style.display = 'block';
        }

        // Funciones de ejercicios
        function loadExercise() {
            if (currentExerciseIndex >= exercises.length) {
                showCompletion();
                return;
            }

            const exercise = exercises[currentExerciseIndex];
            const operationSymbol = exercise.operation === '+' ? '+' : '‚àí';
            
            document.getElementById('exerciseProblem').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                    ${createFractionHTML(exercise.num1, exercise.den1)}
                    <span style="font-size: 2.5rem; color: #e74c3c;">${operationSymbol}</span>
                    ${createFractionHTML(exercise.num2, exercise.den2)}
                    <span style="font-size: 2.5rem; color: #27ae60;">=</span>
                    <span style="font-size: 2.5rem; color: #666;">?</span>
                </div>
            `;
            document.getElementById('answerNum').value = '';
            document.getElementById('answerDen').value = '';
            document.getElementById('feedback').style.display = 'none';
        }

        function checkAnswer() {
            const exercise = exercises[currentExerciseIndex];
            const userNum = parseInt(document.getElementById('answerNum').value);
            const userDen = parseInt(document.getElementById('answerDen').value);
            const feedback = document.getElementById('feedback');

            if (!userNum || !userDen) {
                feedback.innerHTML = '‚ö†Ô∏è Por favor, completa la respuesta';
                feedback.style.background = 'linear-gradient(135deg, #ff6b6b, #ffa8a8)';
                feedback.style.display = 'block';
                return;
            }

            // Verificar si la respuesta es correcta (considerando fracciones equivalentes)
            const userValue = userNum / userDen;
            const correctValue = exercise.answerNum / exercise.answerDen;

            if (Math.abs(userValue - correctValue) < 0.001) {
                feedback.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>üéâ ¬°Correcto!</span>
                        ${createFractionHTML(userNum, userDen)}
                        <span>es la respuesta correcta</span>
                    </div>
                `;
                feedback.style.background = 'linear-gradient(135deg, #56ab2f, #a8e6cf)';
                addPoints(25);
                showFloatingPoints(25);
                completedExercises++;
                updateDisplay();
            } else {
                feedback.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>‚ùå Incorrecto. La respuesta correcta es</span>
                        ${createFractionHTML(exercise.answerNum, exercise.answerDen)}
                    </div>
                `;
                feedback.style.background = 'linear-gradient(135deg, #ff6b6b, #ffa8a8)';
                addPoints(5); // Puntos de consolaci√≥n
            }

            feedback.style.display = 'block';
        }

        function nextExercise() {
            currentExerciseIndex++;
            loadExercise();
        }

        function showHint() {
            const exercise = exercises[currentExerciseIndex];
            const result = performOperation(exercise.num1, exercise.den1, exercise.num2, exercise.den2, exercise.operation);
            
            let hint = '';
            if (exercise.den1 === exercise.den2) {
                hint = `üí° Pista: Como ambas fracciones tienen denominador ${exercise.den1}, solo ${exercise.operation === '+' ? 'suma' : 'resta'} los numeradores: ${exercise.num1} ${exercise.operation} ${exercise.num2}`;
            } else {
                const commonDen = exercise.den1 * exercise.den2;
                hint = `üí° Pista: Busca un denominador com√∫n. Puedes usar ${commonDen} como denominador com√∫n.`;
            }
            
            alert(hint);
        }

        function showCompletion() {
            document.getElementById('exerciseCard').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #4facfe; font-size: 2.5rem; margin-bottom: 20px;">
                        üéâ ¬°Ejercicios Completados! üéâ
                    </h2>
                    <p style="font-size: 1.5rem; color: #666; margin-bottom: 20px;">
                        Has dominado la suma y resta de fracciones
                    </p>
                    <p style="font-size: 1.2rem; color: #555;">
                        ¬°Ahora puedes resolver cualquier operaci√≥n con fracciones!
                    </p>
                    <div style="margin: 30px 0; font-size: 3rem;">üèÜ‚ûï‚ûñ</div>
                </div>
            `;
        }

        function addPoints(points) {
            totalPoints += points;
            localStorage.setItem('mathPoints', totalPoints.toString());
            updateDisplay();
        }

        function showFloatingPoints(points) {
            const pointsElement = document.createElement('div');
            pointsElement.textContent = `+${points}`;
            pointsElement.style.position = 'fixed';
            pointsElement.style.top = '100px';
            pointsElement.style.right = '50px';
            pointsElement.style.color = '#4facfe';
            pointsElement.style.fontSize = '2rem';
            pointsElement.style.fontWeight = 'bold';
            pointsElement.style.zIndex = '9999';
            pointsElement.style.animation = 'floatUp 2s ease-out forwards';
            
            document.body.appendChild(pointsElement);
            
            setTimeout(() => pointsElement.remove(), 2000);
        }

        // Agregar animaci√≥n CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(1.2);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
