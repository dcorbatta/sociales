<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ingl√©s - Vocabulario Interactivo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    .container { max-width: 700px; margin: 30px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #ccc; padding: 30px; }
    h1, h2 { text-align: center; }
    .chapter-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .chapter-btn { background: #e0e0e0; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-weight: bold; }
    .chapter-btn.active { background: #4caf50; color: #fff; }
    .vocab-section { margin: 20px 0; }
    .word-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .hint { color: #888; font-size: 0.95em; margin-bottom: 10px; }
    .meaning-select { margin-bottom: 10px; }
    .canvas-container { border: 1px solid #bbb; border-radius: 8px; background: #fafafa; margin-bottom: 10px; }
    .canvas-actions { margin-bottom: 15px; }
    .next-btn { background: #2196f3; color: #fff; border: none; border-radius: 5px; padding: 8px 18px; cursor: pointer; font-size: 1em; }
    .study-box { background: #e3f2fd; border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; }
    .hidden { display: none; }
    .main-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .main-tab-btn { background: #e0e0e0; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-weight: bold; }
    .main-tab-btn.active { background: #4caf50; color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ingl√©s - Vocabulario Interactivo</h1>
    <div class="main-nav" style="display:flex; justify-content:center; gap:15px; margin-bottom:20px;">
      <button id="vocabTabBtn" class="main-tab-btn active">Vocabulario</button>
      <button id="readingTabBtn" class="main-tab-btn">Comprensi√≥n lectora</button>
      <button id="matchTabBtn" class="main-tab-btn">Unir oraciones</button>
      <button id="mistakeTabBtn" class="main-tab-btn">Corregir errores</button>
    </div>
    <div id="vocabMain">
      <div class="chapter-nav" id="chapterNav"></div>
      <div id="studyMode" class="study-box"></div>
      <div class="vocab-section" id="vocabSection"></div>
    </div>
    <div id="readingMain" style="display:none;">
      <div class="chapter-nav" id="readingChapterNav"></div>
      <div id="readingSection"></div>
    </div>
    <div id="matchMain" style="display:none;">
      <div class="chapter-nav" id="matchChapterNav"></div>
      <div id="matchSection"></div>
    </div>
    <div id="mistakeMain" style="display:none;">
      <div class="chapter-nav" id="mistakeChapterNav"></div>
      <div id="mistakeSection"></div>
    </div>
    <div id="errorMsg" style="color:red; text-align:center; display:none; margin-top:20px;"></div>
    <div style="text-align:center; margin-top:30px; color:#aaa; font-size:0.9em;">Hecho con ‚ù§Ô∏è para aprender ingl√©s</div>
  </div>
  <!-- Signature Pad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script>
try {
// --- Datos de vocabulario y pistas ---
const chapters = [
  {
    name: 'Chapter 1',
    words: [
      { word: 'ancient', hint: 'Dibuja algo muy viejo, como una pir√°mide o un castillo.' },
      { word: 'parent', hint: 'Dibuja una mam√° o un pap√°.' },
      { word: 'market', hint: 'Dibuja un lugar donde la gente compra y vende cosas.' },
      { word: 'cloth', hint: 'Dibuja una tela o ropa.' },
      { word: 'sell', hint: 'Dibuja a alguien vendiendo algo.' },
      { word: 'follow', hint: 'Dibuja a una persona siguiendo a otra.' },
      { word: 'shout', hint: 'Dibuja a alguien gritando.' },
      { word: 'crowd', hint: 'Dibuja un grupo grande de personas.' },
      { word: 'enemy', hint: 'Dibuja dos personas peleando o enojadas.' },
      { word: 'fight', hint: 'Dibuja una pelea.' },
      { word: 'emperor', hint: 'Dibuja un rey o emperador.' },
      { word: 'army', hint: 'Dibuja muchos soldados juntos.' },
      { word: 'plan', hint: 'Dibuja un mapa o una idea.' },
    ],
    meanings: [
      'very old',
      'a mother or father',
      'a place where you buy and sell things',
      'a piece of material for making clothes',
      'to give something for money',
      'to go after someone',
      'to make a loud noise with your voice',
      'a group of people together',
      'a person who is against you',
      'to use force against someone',
      'the leader of a country',
      'a group of soldiers',
      'a way to do something',
    ],
    meaningsEs: [
      'antiguo',
      'padre/madre',
      'mercado',
      'tela',
      'vender',
      'seguir',
      'gritar',
      'multitud',
      'enemigo',
      'pelear',
      'emperador',
      'ej√©rcito',
      'plan',
    ]
  },
  {
    name: 'Chapter 2',
    words: [
      { word: 'punish', hint: 'Dibuja a alguien recibiendo un castigo.' },
      { word: 'news', hint: 'Dibuja un peri√≥dico o alguien contando algo nuevo.' },
      { word: 'strong', hint: 'Dibuja a alguien levantando pesas o mostrando m√∫sculos.' },
      { word: 'soldier', hint: 'Dibuja a una persona con uniforme militar.' },
      { word: 'clothes', hint: 'Dibuja diferentes tipos de ropa.' },
      { word: 'save', hint: 'Dibuja a alguien ayudando a otra persona.' },
      { word: 'brave', hint: 'Dibuja a alguien enfrentando un peligro sin miedo.' },
      { word: 'saddle', hint: 'Dibuja una montura sobre un caballo.' },
      { word: 'clever', hint: 'Dibuja una bombilla o alguien pensando.' },
      { word: 'whisper', hint: 'Dibuja a alguien hablando en secreto al o√≠do de otro.' },
    ],
    meanings: [
      'to make someone suffer for doing something wrong',
      'information about something that has happened',
      'having a lot of physical power',
      'a person in an army',
      'things people wear',
      'to stop something bad from happening',
      'not afraid',
      'a seat for a rider on a horse',
      'smart or intelligent',
      'to speak very quietly',
    ],
    meaningsEs: [
      'castigar',
      'noticia',
      'fuerte',
      'soldado',
      'ropa',
      'salvar',
      'valiente',
      'silla de montar',
      'inteligente',
      'susurrar',
    ]
  },
  {
    name: 'Chapter 3',
    words: [
      { word: 'river', hint: 'Dibuja un r√≠o.' },
      { word: 'snow', hint: 'Dibuja copos de nieve o un paisaje nevado.' },
      { word: 'tent', hint: 'Dibuja una carpa para acampar.' },
      { word: 'light', hint: 'Dibuja una l√°mpara o una bombilla encendida.' },
      { word: 'awake', hint: 'Dibuja a alguien con los ojos abiertos por la ma√±ana.' },
      { word: 'fine', hint: 'Dibuja una carita feliz o algo que est√° bien.' },
      { word: 'battle', hint: 'Dibuja una pelea entre dos grupos.' },
      { word: 'general', hint: 'Dibuja a un jefe militar con medallas.' },
      { word: 'welcome', hint: 'Dibuja un letrero de bienvenida o alguien saludando.' },
      { word: 'towards', hint: 'Dibuja una flecha apuntando hacia algo.' },
      { word: 'next to', hint: 'Dibuja dos cosas una al lado de la otra.' },
      { word: 'win', hint: 'Dibuja una copa o medalla.' },
      { word: 'hero', hint: 'Dibuja a alguien con capa o haciendo algo valiente.' },
    ],
    meanings: [
      'a large stream of water',
      'frozen water that falls from the sky',
      'a shelter made of cloth for sleeping outside',
      'something that makes things bright',
      'not sleeping',
      'good or okay',
      'a fight between armies',
      'the leader of an army',
      'a greeting to someone arriving',
      'in the direction of',
      'beside; at the side of',
      'to be the best in a competition',
      'a very brave person',
    ],
    meaningsEs: [
      'r√≠o',
      'nieve',
      'carpa/tienda',
      'luz',
      'despierto',
      'bien',
      'batalla',
      'general',
      'bienvenida',
      'hacia',
      'al lado de',
      'ganar',
      'h√©roe',
    ]
  },
  {
    name: 'Chapter 4',
    words: [
      { word: 'lead', hint: 'Dibuja a alguien guiando a un grupo.' },
      { word: 'became', hint: 'Dibuja una transformaci√≥n, como oruga a mariposa.' },
      { word: 'famous', hint: 'Dibuja una estrella o alguien en la televisi√≥n.' },
      { word: 'chase', hint: 'Dibuja a alguien corriendo detr√°s de otro.' },
      { word: 'place', hint: 'Dibuja un sitio especial, como una casa o parque.' },
      { word: 'message', hint: 'Dibuja una carta o un tel√©fono.' },
      { word: 'bow', hint: 'Dibuja un arco (de flechas) o alguien haciendo una reverencia.' },
      { word: 'safe', hint: 'Dibuja un escudo o alguien protegido.' },
      { word: 'minister', hint: 'Dibuja a un pol√≠tico o l√≠der importante.' },
      { word: 'fire', hint: 'Dibuja una fogata o llamas.' },
    ],
    meanings: [
      'to guide or be in charge of',
      'changed into',
      'known by many people',
      'to run after someone',
      'a location or area',
      'a written or spoken communication',
      'a weapon for shooting arrows or a gesture of respect',
      'protected from danger',
      'an important government official',
      'something that burns and gives heat and light',
    ],
    meaningsEs: [
      'guiar',
      'convertirse',
      'famoso',
      'perseguir',
      'lugar',
      'mensaje',
      'arco',
      'seguro',
      'ministro',
      'fuego',
    ]
  },
  {
    name: 'Chapter 5',
    words: [
      { word: 'journey', hint: 'Dibuja un mapa o un camino largo.' },
      { word: 'cheer', hint: 'Dibuja a personas aplaudiendo o animando.' },
      { word: 'traveller', hint: 'Dibuja a alguien con mochila o maleta.' },
      { word: 'feast', hint: 'Dibuja una mesa llena de comida.' },
      { word: 'firecracker', hint: 'Dibuja fuegos artificiales peque√±os.' },
      { word: 'gate', hint: 'Dibuja una puerta grande o un port√≥n.' },
    ],
    meanings: [
      'a long trip',
      'to shout in happiness or support',
      'a person who goes from place to place',
      'a large meal for a celebration',
      'a small explosive used for celebrations',
      'a door in a wall or fence',
    ],
    meaningsEs: [
      'viaje',
      'animar/aplaudir',
      'viajero',
      'banquete',
      'petardo',
      'puerta/port√≥n',
    ]
  },
  {
    name: 'Chapter 6',
    words: [
      { word: 'brush', hint: 'Dibuja un cepillo para el pelo.' },
      { word: 'adventure', hint: 'Dibuja a alguien explorando o en una expedici√≥n.' },
      { word: 'explain', hint: 'Dibuja a alguien ense√±ando o mostrando algo.' },
      { word: 'marry', hint: 'Dibuja una boda.' },
      { word: 'husband', hint: 'Dibuja a un hombre casado.' },
      { word: 'wedding', hint: 'Dibuja una pareja en su boda.' },
    ],
    meanings: [
      'to make hair tidy with a brush',
      'an exciting or unusual experience',
      'to make something clear or easy to understand',
      'to become someone\'s wife or husband',
      'a married man',
      'a marriage ceremony',
    ],
    meaningsEs: [
      'cepillar',
      'aventura',
      'explicar',
      'casarse',
      'esposo',
      'boda',
    ]
  },
];

// --- Preguntas de comprensi√≥n lectora por cap√≠tulo ---
const readingQuestions = [
  [ // Cap√≠tulo 1
    { question: 'Where does Mulan live?', options: ['In a little village', 'In a big city', "In the Emperor's palace"], answer: 0 },
    { question: 'Who is old and ill?', options: ['The Emperor', 'Mulan', "Mulan's father"], answer: 2 },
    { question: 'What does Mulan make at home?', options: ['Shoes', 'Cloth', 'Food'], answer: 1 },
    { question: 'Who needs a big army?', options: ['The Emperor', 'Mulan', "Mulan's brother"], answer: 0 },
    { question: 'Who must think of a plan?', options: ['The Emperor', 'The crowd', 'Mulan'], answer: 2 },
    { question: 'Who is Mulan\'s enemy?', options: ['The enemy soldiers', 'The Emperor', 'The army'], answer: 0 },
    { question: 'What does a crowd of people do?', options: ['Sell cloth', 'Look at something', 'Fight'], answer: 1 },
    { question: 'Who does Mulan follow?', options: ['Sun Ying', 'Her father', 'The Emperor'], answer: 0 },
    { question: 'What does Mulan\'s father do?', options: ['He is old and ill', 'He is a soldier', 'He is the Emperor'], answer: 0 },
    { question: 'What does Mulan shout?', options: ['Nothing', 'Her plan', 'Her name'], answer: 1 },
  ],
  [ // Cap√≠tulo 2
    { question: "Why can't Mulan's brother join the army?", options: ["He is too old", "He is the Emperor", "He is too young"], answer: 2 },
    { question: "What does Mulan's father give her before she leaves?", options: ["A sword", "Some money", "A horse"], answer: 1 },
    { question: "Who does Mulan tell her secret to?", options: ["Her brother", "The Emperor", "Sun Ying"], answer: 2 },
    { question: 'What does Mulan\'s family do before she leaves?', options: ['Fights', 'Says goodbye', 'Goes to the market'], answer: 1 },
    { question: 'What does Mulan buy at the market?', options: ['Both', 'A horse', 'A saddle'], answer: 0 },
    { question: 'Who is clever?', options: ['The Emperor', 'Mulan', 'Xiong'], answer: 1 },
    { question: 'Who whispers to Mulan?', options: ['Her father', 'The Emperor', 'Sun Ying'], answer: 2 },
    { question: 'What does Mulan want to save?', options: ['The market', 'Her family name', 'The Emperor'], answer: 1 },
    { question: 'Who is brave?', options: ['Her brother', 'Mulan', 'The Emperor'], answer: 1 },
    { question: 'What does Mulan wear?', options: ['A dress', "Soldier's clothes", 'A hat'], answer: 1 },
  ],
  [ // Cap√≠tulo 3
    { question: "Where do the soldiers sleep?", options: ["In a tent", "In a palace", "In a boat"], answer: 0 },
    { question: "What do the soldiers need in the winter?", options: ["Light", "Fire", "Snow"], answer: 1 },
    { question: "Who is the leader of the army?", options: ["The general", "The Emperor", "Mulan"], answer: 0 },
    { question: 'What do the soldiers walk through?', options: ['Sand', 'Snow', 'Water'], answer: 1 },
    { question: 'What do the soldiers use to see at night?', options: ['A light', 'A tent', 'A river'], answer: 0 },
    { question: 'Who fights in the battle?', options: ['Both', 'Mulan', 'The general'], answer: 0 },
    { question: 'Who welcomes Mulan?', options: ['The soldiers', 'The Emperor', 'The general'], answer: 0 },
    { question: 'What is next to Mulan?', options: ['The general', 'Her horse', 'The Emperor'], answer: 1 },
    { question: 'Who wins the battle?', options: ['The Chinese army', 'The enemy', 'The Emperor'], answer: 0 },
    { question: 'Who is a hero?', options: ['The general', 'The Emperor', 'Mulan'], answer: 2 },
  ],
  [ // Cap√≠tulo 4
    { question: "What does Mulan become?", options: ["A general", "A minister", "A traveller"], answer: 0 },
    { question: "What does the Emperor send to Mulan?", options: ["A horse", "A message", "A bow"], answer: 1 },
    { question: "What does Mulan chase out of China?", options: ["The minister", "The Emperor", "The enemy"], answer: 2 },
    { question: 'Who is famous?', options: ['The Emperor', 'Mulan', 'The minister'], answer: 1 },
    { question: 'What does the Emperor give to Mulan?', options: ['A message', 'A palace', 'A horse'], answer: 2 },
    { question: 'Who is safe?', options: ['The enemy', 'Mulan', 'The minister'], answer: 1 },
    { question: 'Who leads the army?', options: ['The Emperor', 'Mulan', 'The minister'], answer: 1 },
    { question: 'Who became a general?', options: ['The minister', 'The Emperor', 'Mulan'], answer: 2 },
    { question: 'What does the general do?', options: ['Sends a message', 'Leads the army', 'Chases the enemy'], answer: 1 },
    { question: 'Who is the minister?', options: ['A soldier', 'A government official', 'A traveller'], answer: 1 },
  ],
  [ // Cap√≠tulo 5
    { question: "What do Mulan's parents make for her when she returns?", options: ["A feast", "A journey", "A gate"], answer: 0 },
    { question: "What do people do when they see Mulan?", options: ["Cry", "Cheer", "Sleep"], answer: 1 },
    { question: "What does Xiong use to welcome Mulan?", options: ["A horse", "A message", "Firecrackers"], answer: 2 },
    { question: 'What is a traveller?', options: ['A soldier', 'A person who goes from place to place', 'A minister'], answer: 1 },
    { question: 'What is a feast?', options: ['A journey', 'A big meal', 'A message'], answer: 1 },
    { question: 'Where is the gate?', options: ['In the market', 'At the entrance', 'In the palace'], answer: 1 },
    { question: 'Who has a long journey?', options: ['The Emperor', 'Mulan', 'The minister'], answer: 1 },
    { question: 'Who cheers for Mulan?', options: ['The Emperor', 'The people', 'The minister'], answer: 1 },
    { question: 'What do firecrackers do?', options: ['Give food', 'Open the gate', 'Make noise'], answer: 2 },
    { question: 'Who is at the feast?', options: ['The Emperor', "Mulan's family", 'The minister'], answer: 1 },
  ],
  [ // Cap√≠tulo 6
    { question: "What does Mulan do before her wedding?", options: ["Go on an adventure", "Brush her hair", "Fight in a battle"], answer: 1 },
    { question: "Who does Ye Ming love?", options: ["Sun Ying", "The Emperor", "Mulan"], answer: 2 },
    { question: "What is the big event at the end of the story?", options: ["A journey", "A wedding", "A battle"], answer: 1 },
    { question: 'Who is Mulan\'s husband?', options: ['Ye Ming', 'Sun Ying', 'The Emperor'], answer: 0 },
    { question: 'What is an adventure?', options: ['A wedding', 'An exciting experience', 'A message'], answer: 1 },
    { question: 'Who explains things to Mulan?', options: ['Her parents', 'Ye Ming', 'The Emperor'], answer: 1 },
    { question: 'What is a wedding?', options: ['A marriage ceremony', 'A journey', 'A battle'], answer: 0 },
    { question: 'Who brushes Mulan\'s hair?', options: ['Her mother', 'Ye Ming', 'Mulan'], answer: 2 },
    { question: 'Who is at the wedding?', options: ['The Emperor', 'Mulan and Ye Ming', 'The minister'], answer: 1 },
    { question: 'What does Mulan do after the wedding?', options: ['Travels', 'Goes home', 'Fights'], answer: 1 },
  ],
];

const matchSentences = [
  [ // Cap√≠tulo 1
    { start: 'Mulan lives', end: 'in a little village.' },
    { start: "Mulan's father is", end: 'old and ill.' },
    { start: 'At home Mulan is making', end: 'some cloth.' },
    { start: 'A crowd of people is looking at', end: 'Mulan.' },
    { start: 'The Emperor needs', end: 'a big army.' },
    { start: 'Mulan must think of', end: 'a plan.' },
    { start: 'Mulan follows', end: 'Sun Ying.' },
    { start: 'Mulan shouts', end: 'her plan.' },
  ],
  [ // Cap√≠tulo 2
    { start: "Mulan's family says", end: 'goodbye to her.' },
    { start: 'Mulan buys', end: 'a horse and a saddle.' },
    { start: 'Mulan tells her secret to', end: 'Sun Ying.' },
    { start: 'Mulan wears', end: "soldier's clothes." },
    { start: 'Mulan is', end: 'brave and clever.' },
    { start: 'Mulan wants to', end: 'save her family name.' },
    { start: "Mulan's father gives her", end: 'some money.' },
    { start: 'Mulan whispers', end: 'her secret.' },
  ],
  [ // Cap√≠tulo 3
    { start: 'The soldiers sleep', end: 'in a tent.' },
    { start: 'It is very cold', end: 'in the winter.' },
    { start: 'The general is', end: 'the leader of the army.' },
    { start: 'The soldiers walk', end: 'through the snow.' },
    { start: 'The soldiers use', end: 'a light at night.' },
    { start: 'Mulan fights', end: 'in the battle.' },
    { start: 'The soldiers welcome', end: 'Mulan.' },
    { start: 'Mulan is a', end: 'hero.' },
  ],
  [ // Cap√≠tulo 4
    { start: 'Mulan becomes', end: 'a general.' },
    { start: 'The Emperor sends', end: 'a message to Mulan.' },
    { start: 'Mulan chases', end: 'the enemy out of China.' },
    { start: 'Mulan is', end: 'famous.' },
    { start: 'The Emperor gives Mulan', end: 'a horse.' },
    { start: 'Mulan is', end: 'safe.' },
    { start: 'Mulan leads', end: 'the army.' },
    { start: 'The minister is', end: 'a government official.' },
  ],
  [ // Cap√≠tulo 5
    { start: "Mulan's parents make", end: 'a feast for her.' },
    { start: 'People cheer', end: 'when they see Mulan.' },
    { start: 'Xiong uses', end: 'firecrackers to welcome Mulan.' },
    { start: 'A traveller is', end: 'a person who goes from place to place.' },
    { start: 'A feast is', end: 'a big meal.' },
    { start: 'The gate is', end: 'at the entrance.' },
    { start: 'Mulan has', end: 'a long journey.' },
    { start: 'Mulan is at', end: 'the gate.' },
  ],
  [ // Cap√≠tulo 6
    { start: 'Before her wedding, Mulan', end: 'brushes her hair.' },
    { start: 'Ye Ming loves', end: 'Mulan.' },
    { start: 'The big event is', end: 'a wedding.' },
    { start: "Mulan's husband is", end: 'Ye Ming.' },
    { start: 'An adventure is', end: 'an exciting experience.' },
    { start: "Mulan's parents explain", end: 'things to her.' },
    { start: 'A wedding is', end: 'a marriage ceremony.' },
    { start: 'After the wedding, Mulan', end: 'goes home.' },
  ],
];

const mistakeWords = [
  [ // Cap√≠tulo 1
    { phrase: 'Mulan lives in a <b style="color:#d32f2f">big city</b>.', answer: 'little village' },
    { phrase: "Mulan's father is <b style=\"color:#d32f2f\">young and strong</b>.", answer: 'old and ill' },
    { phrase: 'At home Mulan is making <b style="color:#d32f2f">shoes</b>.', answer: 'some cloth' },
    { phrase: 'The Emperor needs a <b style="color:#d32f2f">small army</b>.', answer: 'big army' },
    { phrase: 'Mulan must think of a <b style="color:#d32f2f">party</b>.', answer: 'plan' },
    { phrase: 'Mulan shouts her <b style="color:#d32f2f">name</b>.', answer: 'plan' },
    { phrase: 'A crowd of people is looking at a <b style="color:#d32f2f">dog</b>.', answer: 'Mulan' },
    { phrase: 'Mulan follows the <b style="color:#d32f2f">Emperor</b>.', answer: 'Sun Ying' },
    { phrase: 'The <b style="color:#d32f2f">enemy</b> is Mulan\'s friend.', answer: 'Emperor' },
    { phrase: 'Mulan sells <b style="color:#d32f2f">food</b> at the market.', answer: 'cloth' },
  ],
  [ // Cap√≠tulo 2
    { phrase: "Mulan's family <b style=\"color:#d32f2f\">cries</b> when she leaves.", answer: 'says goodbye' },
    { phrase: 'Mulan buys a <b style="color:#d32f2f">car</b> at the market.', answer: 'horse' },
    { phrase: 'Mulan tells her secret to <b style="color:#d32f2f">the Emperor</b>.', answer: 'Sun Ying' },
    { phrase: 'Mulan wears <b style="color:#d32f2f">a dress</b>.', answer: "soldier's clothes" },
    { phrase: 'Mulan is <b style="color:#d32f2f">afraid</b>.', answer: 'brave' },
    { phrase: 'Mulan wants to <b style="color:#d32f2f">fight</b> her family.', answer: 'save her family name' },
    { phrase: "Mulan's father gives her <b style=\"color:#d32f2f\">a book</b>.", answer: 'some money' },
    { phrase: 'Mulan <b style="color:#d32f2f">shouts</b> her secret.', answer: 'whispers' },
    { phrase: 'Mulan is <b style="color:#d32f2f">weak</b>.', answer: 'strong' },
    { phrase: "Mulan's brother is <b style=\"color:#d32f2f\">old</b>.", answer: 'young' },
  ],
  [ // Cap√≠tulo 3
    { phrase: 'For <b style="color:#d32f2f">five</b> days Mulan rides across rivers and over hills.', answer: 'two' },
    { phrase: 'Mulan finds thousands of soldiers next to the <b style="color:#d32f2f">Red</b> River.', answer: 'Yellow' },
    { phrase: 'Ye Ming gives Mulan a <b style="color:#d32f2f">cold</b> drink.', answer: 'hot' },
    { phrase: 'The soldiers <b style="color:#d32f2f">know</b> Mulan\'s secret.', answer: "don't" },
    { phrase: 'The general of the Chinese army <b style="color:#d32f2f">whispers</b> to the soldiers.', answer: 'talks' },
    { phrase: 'Mulan fights at the <b style="color:#d32f2f">back</b> of the army.', answer: 'front' },
    { phrase: 'An enemy soldier wants to kill <b style="color:#d32f2f">Ye Ming</b>.', answer: 'Mulan' },
    { phrase: 'Ye Ming is now the <b style="color:#d32f2f">hero</b> of the army.', answer: 'Mulan' },
    { phrase: 'The <b style="color:#d32f2f">tent</b> is made of metal.', answer: 'cloth' },
    { phrase: 'The soldiers walk through the <b style="color:#d32f2f">desert</b>.', answer: 'snow' },
  ],
  [ // Cap√≠tulo 4
    { phrase: 'Mulan becomes a <b style="color:#d32f2f">traveller</b>.', answer: 'general' },
    { phrase: 'The Emperor sends a <b style="color:#d32f2f">horse</b> to Mulan.', answer: 'message' },
    { phrase: 'Mulan chases the <b style="color:#d32f2f">minister</b> out of China.', answer: 'enemy' },
    { phrase: 'Mulan is <b style="color:#d32f2f">unknown</b>.', answer: 'famous' },
    { phrase: 'The Emperor gives Mulan a <b style="color:#d32f2f">palace</b>.', answer: 'horse' },
    { phrase: 'Mulan is <b style="color:#d32f2f">in danger</b>.', answer: 'safe' },
    { phrase: 'Mulan <b style="color:#d32f2f">follows</b> the army.', answer: 'leads' },
    { phrase: 'The <b style="color:#d32f2f">soldier</b> is a government official.', answer: 'minister' },
    { phrase: 'The <b style="color:#d32f2f">bow</b> is for music.', answer: 'arrows' },
    { phrase: 'Mulan <b style="color:#d32f2f">loses</b> the battle.', answer: 'wins' },
  ],
  [ // Cap√≠tulo 5
    { phrase: "Mulan's parents <b style=\"color:#d32f2f\">cry</b> for her when she returns.", answer: 'make a feast' },
    { phrase: 'People <b style="color:#d32f2f">sleep</b> when they see Mulan.', answer: 'cheer' },
    { phrase: 'Xiong uses <b style="color:#d32f2f">a horse</b> to welcome Mulan.', answer: 'firecrackers' },
    { phrase: 'A traveller is a <b style="color:#d32f2f">soldier</b>.', answer: 'person who goes from place to place' },
    { phrase: 'A feast is a <b style="color:#d32f2f">journey</b>.', answer: 'big meal' },
    { phrase: 'The gate is <b style="color:#d32f2f">in the palace</b>.', answer: 'at the entrance' },
    { phrase: 'Mulan has a <b style="color:#d32f2f">short</b> journey.', answer: 'long' },
    { phrase: 'Mulan is at the <b style="color:#d32f2f">market</b>.', answer: 'gate' },
    { phrase: 'Firecrackers <b style="color:#d32f2f">give food</b>.', answer: 'make noise' },
    { phrase: 'The <b style="color:#d32f2f">Emperor</b> is at the feast.', answer: "Mulan's family" },
  ],
  [ // Cap√≠tulo 6
    { phrase: 'Before her wedding, Mulan <b style="color:#d32f2f">runs</b>.', answer: 'brushes her hair' },
    { phrase: 'Ye Ming <b style="color:#d32f2f">hates</b> Mulan.', answer: 'loves' },
    { phrase: 'The big event is a <b style="color:#d32f2f">battle</b>.', answer: 'wedding' },
    { phrase: "Mulan's husband is <b style=\"color:#d32f2f\">the Emperor</b>.", answer: 'Ye Ming' },
    { phrase: 'An adventure is a <b style="color:#d32f2f">wedding</b>.', answer: 'exciting experience' },
    { phrase: "Mulan's parents <b style=\"color:#d32f2f\">fight</b> with her.", answer: 'explain things' },
    { phrase: 'A wedding is a <b style="color:#d32f2f">battle</b>.', answer: 'marriage ceremony' },
    { phrase: 'After the wedding, Mulan <b style="color:#d32f2f">travels</b>.', answer: 'goes home' },
    { phrase: 'Ye Ming is a <b style="color:#d32f2f">soldier</b>.', answer: 'husband' },
    { phrase: 'Mulan <b style="color:#d32f2f">forgets</b> her adventure.', answer: 'remembers' },
  ],
];

let currentChapter = 0;
let currentWord = 0;
let signaturePad;

function renderChapterNav() {
  const nav = document.getElementById('chapterNav');
  nav.innerHTML = '';
  chapters.forEach((ch, idx) => {
    const btn = document.createElement('button');
    btn.className = 'chapter-btn' + (idx === currentChapter ? ' active' : '');
    btn.textContent = ch.name;
    btn.onclick = () => { currentChapter = idx; currentWord = 0; renderVocab(); };
    nav.appendChild(btn);
  });
}

function renderStudyBox() {
  const box = document.getElementById('studyMode');
  const ch = chapters[currentChapter];
  let html = '<b>Study these words:</b><ul>';
  ch.words.forEach((w, i) => {
    html += `<li><b>${w.word}</b>: <i>${ch.meanings[i]}</i></li>`;
  });
  html += '</ul>';
  box.innerHTML = html;
  box.classList.remove('hidden');
}

function renderVocab() {
  renderChapterNav();
  renderStudyBox();
  const section = document.getElementById('vocabSection');
  const ch = chapters[currentChapter];
  const w = ch.words[currentWord];
  section.innerHTML = `
    <div class="word-title">${w.word}</div>
    <div class="hint">Pista para dibujar: ${w.hint}</div>
    <div class="meaning-select">
      <label for="meaningSel">¬øCu√°l es la traducci√≥n en espa√±ol?</label><br>
      <select id="meaningSel">
        <option value="">Selecciona...</option>
        ${ch.meaningsEs.map((m, i) => `<option value="${i}">${m}</option>`).join('')}
      </select>
      <div id="vocabFeedback" style="margin-top:8px; min-height:22px;"></div>
    </div>
    <div class="canvas-container">
      <canvas id="drawCanvas" width="400" height="180"></canvas>
      <div class="canvas-actions">
        <button onclick="signaturePad.clear()"><i class="fa fa-eraser"></i> Borrar dibujo</button>
      </div>
    </div>
    <button class="next-btn" onclick="nextWord()">${currentWord < ch.words.length - 1 ? 'Siguiente palabra' : 'Terminar cap√≠tulo'}</button>
    <div style="margin-top:10px; text-align:right; color:#888;">Palabra ${currentWord+1} de ${ch.words.length}</div>
  `;
  setTimeout(() => {
    const canvas = document.getElementById('drawCanvas');
    signaturePad = new SignaturePad(canvas, { minWidth: 1, maxWidth: 2 });
    const sel = document.getElementById('meaningSel');
    sel.onchange = () => {
      const feedback = document.getElementById('vocabFeedback');
      if (sel.value === "") {
        feedback.textContent = '';
      } else if (parseInt(sel.value) === currentWord) {
        feedback.innerHTML = '<span style="color:green; font-weight:bold;">¬°Correcto!</span>';
      } else {
        feedback.innerHTML = '<span style="color:#d32f2f; font-weight:bold;">Incorrecto. Intenta de nuevo.</span>';
      }
    };
  }, 100);
}

function nextWord() {
  const ch = chapters[currentChapter];
  if (currentWord < ch.words.length - 1) {
    currentWord++;
    renderVocab();
  } else {
    alert('¬°Terminaste el cap√≠tulo! Puedes repasar o cambiar de cap√≠tulo.');
    currentWord = 0;
    renderVocab();
  }
}

// --- Navegaci√≥n principal ---
const vocabTabBtn = document.getElementById('vocabTabBtn');
const readingTabBtn = document.getElementById('readingTabBtn');
const matchTabBtn = document.getElementById('matchTabBtn');
const mistakeTabBtn = document.getElementById('mistakeTabBtn');
const vocabMain = document.getElementById('vocabMain');
const readingMain = document.getElementById('readingMain');
const matchMain = document.getElementById('matchMain');
const mistakeMain = document.getElementById('mistakeMain');

vocabTabBtn.onclick = () => {
  vocabTabBtn.classList.add('active');
  readingTabBtn.classList.remove('active');
  matchTabBtn.classList.remove('active');
  mistakeTabBtn.classList.remove('active');
  vocabMain.style.display = '';
  readingMain.style.display = 'none';
  matchMain.style.display = 'none';
  mistakeMain.style.display = 'none';
};
readingTabBtn.onclick = () => {
  vocabTabBtn.classList.remove('active');
  readingTabBtn.classList.add('active');
  matchTabBtn.classList.remove('active');
  mistakeTabBtn.classList.remove('active');
  vocabMain.style.display = 'none';
  readingMain.style.display = '';
  matchMain.style.display = 'none';
  mistakeMain.style.display = 'none';
  renderReadingChapterNav();
  renderReadingSection();
};
matchTabBtn.onclick = () => {
  vocabTabBtn.classList.remove('active');
  readingTabBtn.classList.remove('active');
  matchTabBtn.classList.add('active');
  mistakeTabBtn.classList.remove('active');
  vocabMain.style.display = 'none';
  readingMain.style.display = 'none';
  matchMain.style.display = '';
  renderMatchChapterNav();
  renderMatchSection();
};
mistakeTabBtn.onclick = () => {
  vocabTabBtn.classList.remove('active');
  readingTabBtn.classList.remove('active');
  matchTabBtn.classList.remove('active');
  mistakeTabBtn.classList.add('active');
  vocabMain.style.display = 'none';
  readingMain.style.display = 'none';
  matchMain.style.display = 'none';
  mistakeMain.style.display = '';
  renderMistakeChapterNav();
  renderMistakeSection();
};

// --- Comprensi√≥n lectora ---
let currentReadingChapter = 0;
let currentReadingQ = 0;
let readingScore = 0;

function renderReadingChapterNav() {
  const nav = document.getElementById('readingChapterNav');
  nav.innerHTML = '';
  chapters.forEach((ch, idx) => {
    const btn = document.createElement('button');
    btn.className = 'chapter-btn' + (idx === currentReadingChapter ? ' active' : '');
    btn.textContent = ch.name;
    btn.onclick = () => { currentReadingChapter = idx; currentReadingQ = 0; readingScore = 0; renderReadingSection(); renderReadingChapterNav(); };
    nav.appendChild(btn);
  });
}

function renderReadingSection() {
  const section = document.getElementById('readingSection');
  const qs = readingQuestions[currentReadingChapter] || [];
  if (currentReadingQ >= qs.length) {
    section.innerHTML = `<div style='font-size:1.2em; text-align:center; margin:30px 0;'>¬°Terminaste!<br>Puntaje: <b>${readingScore} / ${qs.length}</b></div>
    <button onclick='currentReadingQ=0;readingScore=0;renderReadingSection()' class='next-btn'>Repetir cap√≠tulo</button>`;
    return;
  }
  const q = qs[currentReadingQ];
  section.innerHTML = `
    <div style='font-size:1.1em; margin-bottom:10px;'><b>Pregunta ${currentReadingQ+1}:</b> ${q.question}</div>
    <div id='readingOpts'></div>
    <div id='readingFeedback' style='margin:10px 0; min-height:24px;'></div>
    <button id='nextReadingBtn' class='next-btn' style='display:none;'>Siguiente</button>
    <div style='margin-top:10px; text-align:right; color:#888;'>${currentReadingQ+1} de ${qs.length}</div>
  `;
  const optsDiv = document.getElementById('readingOpts');
  q.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.textContent = opt;
    btn.className = 'chapter-btn';
    btn.style.margin = '6px 0';
    btn.style.display = 'block';
    btn.onclick = () => {
      if (i === q.answer) {
        document.getElementById('readingFeedback').textContent = '¬°Correcto!';
        readingScore++;
      } else {
        document.getElementById('readingFeedback').textContent = 'Incorrecto. La respuesta correcta es: ' + q.options[q.answer];
      }
      Array.from(optsDiv.children).forEach(b => b.disabled = true);
      document.getElementById('nextReadingBtn').style.display = '';
    };
    optsDiv.appendChild(btn);
  });
  document.getElementById('nextReadingBtn').onclick = () => {
    currentReadingQ++;
    renderReadingSection();
  };
}

// --- Unir oraciones (drag & drop) ---
let currentMatchChapter = 0;
let matchPairs = [];
let matchResults = [];

function renderMatchChapterNav() {
  const nav = document.getElementById('matchChapterNav');
  nav.innerHTML = '';
  chapters.forEach((ch, idx) => {
    const btn = document.createElement('button');
    btn.className = 'chapter-btn' + (idx === currentMatchChapter ? ' active' : '');
    btn.textContent = ch.name;
    btn.onclick = () => { currentMatchChapter = idx; renderMatchSection(); renderMatchChapterNav(); };
    nav.appendChild(btn);
  });
}

function shuffleArray(arr) {
  return arr.map(v => [Math.random(), v]).sort().map(a => a[1]);
}

function renderMatchSection() {
  const section = document.getElementById('matchSection');
  const pairs = matchSentences[currentMatchChapter] || [];
  const ends = shuffleArray(pairs.map((p) => p.end));
  matchResults = Array(pairs.length).fill(null);
  let html = `<form id='matchForm'><table style='margin:auto; border-spacing:12px 8px;'>
    <tr><th style='text-align:left;'>Inicios</th><th>Finales</th></tr>`;
  pairs.forEach((p, i) => {
    html += `<tr><td style='background:#e3f2fd; padding:8px; border-radius:6px;'>${p.start}</td><td><select id='matchSel${i}' style='padding:6px; border-radius:5px;'><option value=''>Selecciona...</option>${ends.map((end, j) => `<option value='${end}'>${end}</option>`).join('')}</select></td></tr>`;
  });
  html += `</table></form>
  <div id='matchFeedback' style='margin-top:20px;'></div>
  <button class='next-btn' onclick='checkMatchResults()' style='margin-top:20px;'>Corregir</button>
  <button class='next-btn' onclick='renderMatchSection();return false;' style='margin-top:20px; background:#aaa;'>Resetear</button>`;
  section.innerHTML = html;
}

function checkMatchResults() {
  const pairs = matchSentences[currentMatchChapter] || [];
  let correct = 0;
  for (let i = 0; i < pairs.length; i++) {
    const sel = document.getElementById('matchSel'+i);
    if (sel && sel.value === pairs[i].end) correct++;
  }
  const feedback = document.getElementById('matchFeedback');
  if (correct === pairs.length) {
    feedback.innerHTML = `<span style='color:green; font-weight:bold;'>¬°Todo correcto! üéâ</span>`;
  } else {
    feedback.innerHTML = `<span style='color:#d32f2f; font-weight:bold;'>${correct} de ${pairs.length} correctos. Intenta de nuevo.</span>`;
  }
}

// --- Corregir errores (palabra) ---
let currentMistakeWordChapter = 0;
let currentMistakeWordIdx = 0;

function renderMistakeChapterNav() {
  const nav = document.getElementById('mistakeChapterNav');
  nav.innerHTML = '';
  chapters.forEach((ch, idx) => {
    const btn = document.createElement('button');
    btn.className = 'chapter-btn' + (idx === currentMistakeWordChapter ? ' active' : '');
    btn.textContent = ch.name;
    btn.onclick = () => { currentMistakeWordChapter = idx; currentMistakeWordIdx = 0; renderMistakeSection(); renderMistakeChapterNav(); };
    nav.appendChild(btn);
  });
}

function normalizeText(str) {
  return str.toLowerCase().replace(/\s+/g, ' ').trim();
}

function renderMistakeSection() {
  const section = document.getElementById('mistakeSection');
  const sentences = mistakeWords[currentMistakeWordChapter] || [];
  if (currentMistakeWordIdx >= sentences.length) {
    section.innerHTML = `<div style='font-size:1.2em; text-align:center; margin:30px 0;'>¬°Terminaste!<br></div>
    <button onclick='currentMistakeWordIdx=0;renderMistakeSection()' class='next-btn'>Repetir cap√≠tulo</button>`;
    return;
  }
  const s = sentences[currentMistakeWordIdx];
  section.innerHTML = `
    <div style='font-size:1.1em; margin-bottom:10px;'><b>Corrige la palabra:</b></div>
    <div style='background:#fffde7; padding:10px 12px; border-radius:7px; margin-bottom:10px;'>${s.phrase}</div>
    <input id='mistakeInput' type='text' style='width:60%; padding:8px; border-radius:6px; border:1px solid #bbb; font-size:1em;' placeholder='Palabra correcta'>
    <div id='mistakeFeedback' style='margin:10px 0; min-height:24px;'></div>
    <button class='next-btn' id='mistakeCheckBtn'>Comprobar</button>
    <button class='next-btn' id='mistakeNextBtn' style='display:none; background:#aaa;'>Siguiente</button>
    <div style='margin-top:10px; text-align:right; color:#888;'>Frase ${currentMistakeWordIdx+1} de ${sentences.length}</div>
  `;
  const input = document.getElementById('mistakeInput');
  const checkBtn = document.getElementById('mistakeCheckBtn');
  const nextBtn = document.getElementById('mistakeNextBtn');
  function checkMistake() {
    const feedback = document.getElementById('mistakeFeedback');
    if (normalizeText(input.value) === normalizeText(s.answer)) {
      feedback.innerHTML = '<span style="color:green; font-weight:bold;">¬°Correcto!</span>';
      nextBtn.style.display = '';
      input.disabled = true;
      checkBtn.disabled = true;
    } else {
      feedback.innerHTML = `<span style='color:#d32f2f; font-weight:bold;'>Incorrecto.</span> <span style='font-size:0.95em;'>Respuesta: <i>${s.answer}</i></span>`;
      nextBtn.style.display = 'none';
    }
  }
  checkBtn.onclick = checkMistake;
  input.onblur = function() { if (input.value.trim() !== '') checkMistake(); };
  nextBtn.onclick = () => {
    currentMistakeWordIdx++;
    renderMistakeSection();
  };
}

window.onload = () => {
  renderVocab();
};
} catch (e) {
  document.getElementById('errorMsg').style.display = 'block';
  document.getElementById('errorMsg').textContent = 'Error en el c√≥digo: ' + e.message;
}
  </script>
</body>
</html> 